{% extends "account/base.html" %}

{% load static %} 

{% block title %}
    Dashbaord
{% endblock title %}

{% block style %}

<link rel="stylesheet" href="{% static 'customer/css/style.css' %}">


{% endblock style %}


{% block content %}
 <section id="shop">
        <div class="container mx-auto">
            <!-- Filter Toggle Button for Mobile -->
            <div class="block md:hidden text-center mb-4">
                <button id="products-toggle-filters"
                    class="bg-primary text-white py-2 px-4 rounded-full focus:outline-none">Show Filters</button>
            </div>
            <div class="flex flex-col md:flex-row">
                <!-- Filters -->
                {% include 'customer/components/customer-sidebars.html' %}

                <!--content-->
                {% block customer_content %}
                
                <div class="w-full md:w-3/4 p-4">
                    <div id="profile" class="content-section active bg-white p-6 rounded-xl shadow-lg ">
                        <h2 class="text-2xl font-semibold text-gray-900 mb-6 flex items-center">
                            <!-- Icon placeholder for User - replaced data-lucide with a simple SVG for robustness -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 mr-3 text-primary-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                            Welcome Back, Jane!
                        </h2>
                        
                        <!-- Key Metrics Cards: Highly responsive grid -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 text-center">
                            <div class="p-4 bg-gray-50 rounded-lg shadow-sm">
                                <p class="text-3xl font-bold text-primary-500">{{ orders_count|default:0 }}</p>
                                <p class="text-sm text-gray-600">Total Orders</p>
                            </div>
                            <div class="p-4 bg-gray-50 rounded-lg shadow-sm">
                                <p class="text-3xl font-bold text-primary-500">$5{{ total_spent|default:0|floatformat:2 }}</p>
                                <p class="text-sm text-gray-600">Total Spent</p>
                            </div>
                            <div class="p-4 bg-gray-50 rounded-lg shadow-sm">
                                <p class="text-3xl font-bold text-primary-500">12</p>
                                <p class="text-sm text-gray-600">Items in Wishlist</p>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="mt-8">
                            <h3 class="text-xl font-semibold mb-3 border-t pt-4">Quick Actions</h3>
                            <div class="flex flex-wrap gap-3 sm:gap-4">
                                <a href="{% url 'customer_order_history' %}" class="bg-primary-500 text-white px-5 py-2 rounded-full text-sm font-medium hover:bg-primary-600 transition shadow-md whitespace-nowrap">
                                    Track Latest Order
                                </a>
                                <button class="border border-primary-500 text-primary-500 px-5 py-2 rounded-full text-sm font-medium hover:bg-primary-50 transition whitespace-nowrap">
                                    Manage Subscription
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                {% endblock customer_content %}

            </div>
        </div>
    </section>
{% endblock content %}

{% block script %}
<script src="https://unpkg.com/lucide@latest"></script>
<script>
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();


            // Profile pic update
            const input = document.getElementById("profilePicInput");
            const btn = document.getElementById("changePicBtn");
            const preview = document.getElementById("profilePicPreview");
            const MAX_SIZE = 2 * 1024 * 1024;
            const ALLOWED = ["image/jpeg", "image/png", "image/jpg"];

            btn.addEventListener("click", () => input.click());

            input.addEventListener("change", () => {
                const file = input.files[0];
                if (!file) return;

                if (!ALLOWED.includes(file.type)) {
                showToast('warning', "Only JPG and PNG allowed.");
                return;
                }
                if (file.size > MAX_SIZE) {
                showToast('warning', "Max image size is 2MB.");
                return;
                }

                // Show preview before upload
                const reader = new FileReader();
                reader.onload = e => preview.src = e.target.result;
                reader.readAsDataURL(file);

                const formData = new FormData();
                formData.append("profile_pic", file);

                fetch("{% url 'update_profile_pic' %}", {
                method: "POST",
                headers: { "X-CSRFToken": "{{ csrf_token }}" },
                body: formData
                })
                .then(res => res.json())
                .then(data => {
                if (data.success) showToast('success', data.message);
                else showToast('error', "Error! " + (data.errors?.profile_pic?.[0] || "Upload failed"));
                })
                .catch(err => showToast('error', "Error! Something went wrong: " + err));
            });
        });

        function togglePassword(fieldId, btn) {
            const input = document.getElementById(fieldId);
            const isPassword = input.type === "password";
            input.type = isPassword ? "text" : "password";

            // Change the icon
            btn.innerHTML = `<i data-lucide="${isPassword ? "eye-off" : "eye"}" class="w-6 h-6"></i>`;
            lucide.createIcons();
        }

</script>

{% endblock script %}