{% extends "seller/dashboard.html" %}
{% load static %}

{% block title %}Product List{% endblock title %}

{% block seller_content %}
<div class="w-full md:w-3/4 p-4">
    <div class="bg-white p-6 rounded-xl shadow-lg">

        <!-- Header -->
        <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
            <h2 class="text-2xl font-semibold text-gray-900 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 mr-2 text-primary-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path d="m7.5 4.27 9 5.15"></path>
                    <path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"></path>
                    <path d="m3.3 7 8.7 5 8.7-5"></path>
                    <path d="M12 22V12"></path>
                </svg>
                Product List
            </h2>

            <a href="{% url 'product_create' %}" class="bg-primary border border-transparent hover:bg-transparent hover:border-primary text-white hover:text-primary font-semibold py-2 px-4 rounded-full">
                + Add Product
            </a>
        </div>

        <!-- Search Bar -->
        <form method="get" class="mb-4">
            <div class="flex items-center w-full md:w-1/2 border border-gray-300 rounded-full overflow-hidden">
                <input
                    type="text"
                    name="q"
                    value="{{ query }}"
                    placeholder="Search by name or category..."
                    class="w-full px-4 py-2 focus:outline-none text-gray-700"
                >
                <button type="submit" class="px-4 bg-blue-600 hover:bg-blue-700 transition flex items-center justify-center">
                    <i data-lucide="search" class="w-5 h-5"></i>
                </button>

            </div>
        </form>

        {% if products %}
        <div class="overflow-x-auto">
            <table class="min-w-full text-left text-sm border border-gray-200 rounded-lg overflow-hidden">
                <thead class="bg-gray-100 text-gray-700 uppercase text-xs font-semibold">
                    <tr>
                        <th class="px-4 py-3">#</th>
                        <th class="px-4 py-3">Image</th>
                        <th class="px-4 py-3">Name</th>
                        <th class="px-4 py-3">Category</th>
                        <th class="px-4 py-3">Price</th>
                        <th class="px-4 py-3">Stock</th>
                        <th class="px-4 py-3">Status</th>
                        <th class="px-4 py-3 text-center">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                    {% for product in products %}
                    <tr class="hover:bg-gray-50 transition">
                        <td class="px-4 py-3 text-gray-600">{{ forloop.counter }}</td>
                        <td class="px-4 py-3">
                            {% if product.images.first %}
                                <img src="{{ product.images.first.image.url }}" alt="{{ product.name }}" class="h-12 w-12 object-cover rounded-md">
                            {% else %}
                                <img src="{% static 'images/no-image.png' %}" alt="No Image" class="h-12 w-12 object-cover rounded-md">
                            {% endif %}
                        </td>
                        <td class="px-4 py-3 font-medium text-gray-900">{{ product.name }}</td>
                        <td class="px-4 py-3 text-gray-700">{{ product.category.name }}</td>
                        <td class="px-4 py-3 font-semibold text-gray-800">â‚¹{{ product.price }}</td>
                        <td class="px-4 py-3 text-gray-700">{{ product.stock }}</td>
                        <td class="px-4 py-3">
                            {% if product.is_active %}
                                <span class="text-xs bg-green-100 text-green-700 font-medium px-2 py-1 rounded-full">Active</span>
                            {% else %}
                                <span class="text-xs bg-red-100 text-red-700 font-medium px-2 py-1 rounded-full">Inactive</span>
                            {% endif %}
                        </td>
                        <td class="px-4 py-4 my-2 flex items-center justify-center gap-3">
                            <a href="{% url 'product_edit' product.id %}" class="text-blue-600 hover:text-blue-800" title="Edit">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232a2.5 2.5 0 113.536 3.536L7.5 20.036H4v-3.536l11.232-11.268z" />
                                </svg>
                            </a>
                            <a href="{% url 'product_delete' product.id %}" class="delete-product-btn text-red-600 hover:text-red-800" title="Delete">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5-4h4m-6 4h8" />
                                </svg>
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="flex justify-between items-center mt-6 text-sm">
            <span class="text-gray-600">
                Page {{ products.number }} of {{ products.paginator.num_pages }}
            </span>

            <div class="flex space-x-2">
                {% if products.has_previous %}
                    <a href="?q={{ query }}&page={{ products.previous_page_number }}" class="w-10 h-10 flex items-center justify-center rounded-full">Prev</a>
                {% endif %}
                {% for num in products.paginator.page_range %}
                    {% if num == products.number %}
                        <span class="bg-primary text-white w-10 h-10 flex items-center justify-center rounded-full">{{ num }}</span>
                    {% elif num > products.number|add:'-2' and num < products.number|add:'2' %}
                        <a href="?q={{ query }}&page={{ num }}" class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-primary hover:text-white">{{ num }}</a>
                    {% endif %}
                {% endfor %}
                {% if products.has_next %}
                    <a href="?q={{ query }}&page={{ products.next_page_number }}" class="w-10 h-10 flex items-center justify-center rounded-full">Next</a>
                {% endif %}
            </div>
        </div>
        {% else %}
            <p class="text-gray-500 text-center py-10">No products found. 
                <a href="{% url 'product_create' %}" class="text-blue-600 hover:underline">Add a new product</a>.
            </p>
        {% endif %}
    </div>
</div>
{% endblock seller_content %}

{% block script %}
{{ block.super }}
<script>
     document.addEventListener('DOMContentLoaded', function(){
            const productDeleteBtns = document.querySelectorAll(".delete-product-btn");

            productDeleteBtns.forEach(productDeleteBtn =>{
                if (productDeleteBtn) {
                    const url = productDeleteBtn.getAttribute('href');
    
                    productDeleteBtn.addEventListener('click', function(e){
                        e.preventDefault(); 
                        if(url){
                            confirmAction({
                                title: 'Delete Product?',
                                text: 'This will permanently remove the product. Are you absolutely certain?',
                                confirmText: 'Yes, DELETE IT',
                                confirmUrl: url,
                            });
                        }else{
                            console.log('Url not found on delete button.');
                        }
                    });
                }else{
                    console.log("Delete button not found.");
                }
            })
        });
</script>

{% endblock script %}