{% extends 'account/base.html' %}
{% load static %}
{% load core_filters %}

{% block title %} Product Details {% endblock %}

{% block style %}
  <style>
  .ratio-4-3 { position: relative; width: 100%; padding-top: 75%; background: #f8fafc; overflow: hidden; }
  .ratio-4-3 img { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: contain; object-position: center; transition: transform .25s ease; background:#ebebeb;}
  .ratio-4-3 img:hover { transform: scale(1.04); }
</style>

{% endblock style %}

{% block content %}

     <!-- Shop -->
    <section id="shop">
        <div class="container mx-auto">
            <!-- Top Filter -->
            <div class="flex flex-col md:flex-row justify-between items-center py-4">
                <div class="flex items-center space-x-4">
                    <button
                        class="bg-primary text-white hover:bg-transparent hover:text-primary border hover:border-primary py-2 px-4 rounded-full focus:outline-none">Show
                        On
                        Sale</button>
                    <button
                        class="bg-primary text-white hover:bg-transparent hover:text-primary border hover:border-primary py-2 px-4 rounded-full focus:outline-none">List
                        View</button>
                    <button
                        class="bg-primary text-white hover:bg-transparent hover:text-primary border hover:border-primary py-2 px-4 rounded-full focus:outline-none">Grid
                        View</button>
                </div>
                <div class="flex mt-5 md:mt-0 space-x-4">
                    <div class="relative">
                        <form method="GET" id="filter-type-form">
                            {% if request.GET.page %}
                                <input type="hidden" name="page" value="{{ request.GET.page }}">
                            {% endif %}
                            <select name="sort_by" id="filter-type"
                                class="block appearance-none w-full bg-white border  hover:border-primary px-4 py-2 pr-8 rounded-full shadow leading-tight focus:outline-none focus:shadow-outline">
                                <option value="latest" {% if request.GET.sort_by == 'latest' or not request.GET.sort_by %}selected{% endif %}>Sort by Latest</option>
                                <option value="popular" {% if request.GET.sort_by == 'popular' %}selected{% endif %}>Sort by Popularity</option>
                                <option value="a_z" {% if request.GET.sort_by == 'a_z' %}selected{% endif %}>Sort by A-Z</option>
                            </select>
                            <div
                                class="pointer-events-none absolute inset-y-0 right-0 flex items-center justify-center px-2">
                                <img id="arrow-down" class="h-4 w-4" src="{% static '/assets/images/filter-down-arrow.svg' %}"
                                    alt="filter arrow">
                                <img id="arrow-up" class="h-4 w-4 hidden" src="{% static '/assets/images/filter-up-arrow.svg' %}"
                                    alt="filter arrow">
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <!-- Filter Toggle Button for Mobile -->
            <div class="block md:hidden text-center mb-4">
                <button id="products-toggle-filters"
                    class="bg-primary text-white py-2 px-4 rounded-full focus:outline-none">Show Filters</button>
            </div>
            <div class="flex flex-col md:flex-row">
                <!-- Filters -->
                <div id="filters" class="w-full md:w-1/4 p-4 hidden md:block">
                    <!-- Category Filter -->
                    <div class="mb-6 pb-8 border-b border-gray-line">
                        <h3 class="text-lg font-semibold mb-6">Category</h3>
                        <div class="space-y-2">
                            {% if sibling_categories %}
                                {% for category in sibling_categories %}
                                <label class="flex items-center">
                                    <input type="checkbox" class="form-checkbox custom-checkbox">
                                    <span class="ml-2">{{ category.name }}</span>
                                </label>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>
                    <!-- Size Filter -->
                    <div class="mb-6 pb-8 border-b border-gray-line">
                        <h3 class="text-lg font-semibold mb-6">Size</h3>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" class="form-checkbox custom-checkbox">
                                <span class="ml-2">S (30)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="form-checkbox custom-checkbox">
                                <span class="ml-2">M (44)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="form-checkbox custom-checkbox">
                                <span class="ml-2">L (22)</span>
                            </label>
                        </div>
                    </div>
                    <!-- Color Filter -->
                    <div class="mb-6 pb-8 border-b border-gray-line">
                        <h3 class="text-lg font-semibold mb-6">Color</h3>
                        <div class="space-y-2">
                            <label class="flex items-center custom-color-checkbox" data-color="#ff0000">
                                <input type="checkbox" class="form-checkbox custom-checkbox">
                                <span class="ml-2">Red</span>
                            </label>
                            <label class="flex items-center custom-color-checkbox" data-color="#0000ff">
                                <input type="checkbox" class="form-checkbox custom-checkbox">
                                <span class="ml-2">Blue</span>
                            </label>
                            <label class="flex items-center custom-color-checkbox" data-color="#00ff00">
                                <input type="checkbox" class="form-checkbox custom-checkbox">
                                <span class="ml-2">Green</span>
                            </label>
                        </div>
                    </div>
                    <!-- Brand Filter -->
                    <div class="mb-6 pb-8 border-b border-gray-line">
                        <h3 class="text-lg font-semibold mb-6">Brand</h3>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" class="form-checkbox custom-checkbox">
                                <span class="ml-2">Nike</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="form-checkbox custom-checkbox">
                                <span class="ml-2">Adidas</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="form-checkbox custom-checkbox">
                                <span class="ml-2">Puma</span>
                            </label>
                        </div>
                    </div>
                    <!-- Rating Filter -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-6">Rating</h3>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" class="form-checkbox custom-checkbox">
                                <span class="ml-2">★★★★★</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="form-checkbox custom-checkbox">
                                <span class="ml-2">★★★★☆</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="form-checkbox custom-checkbox">
                                <span class="ml-2">★★★☆☆</span>
                            </label>
                        </div>
                    </div>
                </div>
                <!-- Products List -->
                <div class="w-full md:w-3/4 p-4">
                    <!-- Products grid -->
                    {% if products %}
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                            {% for product in products %}
                                <div class="bg-white p-4 rounded-lg shadow">
                                    <a href="{% url 'product_detail' product.id %}" class="block ratio-4-3 rounded-t-lg overflow-hidden" title="{{ product.name }}">
                                        {% if product.images.first %}
                                            <img src="{{ product.images.first.image.url }}" alt="{{ product.name }}"
                                                class="w-full object-cover mb-4 rounded-lg h-64 bg-gray-100 object-center">
                                        {% else %}
                                            <img src="{% static 'images/no-image.png' %}" alt="No image"
                                                class="w-full object-cover mb-4 rounded-lg h-64 bg-gray-100 object-center">
                                        {% endif %}
                                    </a>
                                    <a href="{% url 'product_detail' product.id %}" class="text-lg font-semibold mb-2 block">{{ product.name }}</a>
                                    <p class="my-2 text-gray-500">{{ product.category.name }}</p>

                                    <div class="flex items-center mb-4">
                                        <span class="text-lg font-bold text-primary">
                                            ${{ product.discount_price|default:product.price }}
                                        </span>
                                        {% if product.discount_price %}
                                            <span class="text-sm line-through ml-2">${{ product.price }}</span>
                                        {% endif %}
                                    </div>

                                    <button
                                        data-url="{% url 'add_to_cart' product.id %}"
                                        class="addToCartButton bg-primary border border-transparent hover:bg-transparent hover:border-primary text-white hover:text-primary font-semibold py-2 px-4 rounded-full w-full">
                                        Add to Cart
                                    </button>
                                </div>
                            {% empty %}
                                <div class="col-span-full text-center py-10 bg-white rounded-lg shadow">
                                    <p class="text-gray-500 text-lg font-medium">No products found in this category.</p>
                                </div>
                            {% endfor %}
                    </div>

                    <!-- Pagination -->
                    <div class="flex justify-center mt-8">
                        <nav aria-label="Page navigation">
                            <ul class="inline-flex space-x-2">
                                {% if products.has_previous %}
                                    <li>
                                        <a href="?q={{ query }}&page={{ products.previous_page_number }}" class="w-10 h-10 flex items-center justify-center rounded-full">Prev</a>
                                    </li>
                                {% endif %}

                                {% for num in products.paginator.page_range %}
                                    {% if num == products.number %}
                                        <li>
                                            <a href="#"
                                                class="bg-primary text-white w-10 h-10 flex items-center justify-center rounded-full">{{ num }}</a>
                                        </li>
                                    {% elif num > products.number|add:'-2' and num < products.number|add:'2' %}
                                     <li>
                                        <a href="?q={{ query }}&page={{ num }}"
                                            class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-primary hover:text-white">{{ num }}</a>
                                    </li>
                                    {% endif %}
                                {% endfor %}
                                {% if products.has_next %}
                                    <li>
                                        <a href="?q={{ query }}&page={{ products.next_page_number }}" class="w-10 h-10 flex items-center justify-center rounded-full">Next</a>
                                    </li>
                                {% endif %}
                            </ul>
                        </nav>
                    </div>
                     {% else %}
                        <div class="col-span-full text-center py-10 bg-white rounded-lg shadow">
                            <p class="text-gray-500 text-lg font-medium">No products available at the moment.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </section>

    <!-- Shop category description -->
    <section id="shop-category-description" class="py-8">
        <div class="container mx-auto">
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-bold mb-4">{{ current_category.name }}</h2>
                <p class="mb-4">
                    {{ current_category.description|default:'N/A' }}
                </p>
            </div>
        </div>
    </section>

{% endblock %}

{% block script %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const filterType = document.getElementById("filter-type");
        const filterTypeForm = document.getElementById("filter-type-form");
        filterType.addEventListener('change', ()=>{
            filterTypeForm.submit();
        });
    });
</script>
{% endblock script %}